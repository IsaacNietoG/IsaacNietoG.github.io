<!doctype html>
<html class="not-ready lg:text-base" lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- Title -->
  <title>
    Road to HackMex: Dia 4 - Catcabbage - Tchai&#x27;s Halls of Reflection
  </title>

  <!-- Meta -->
  <meta name="theme-color" />

  
  <!-- Author -->
  
  <!---->
  
  <!---->
  
  <!---->
  
  <!---->
  
  <!---->
  <meta name="description" content="Cuarta máquina del entrenamiento para Hackmex" />
  <meta name="author" content="IsaacNietoG" />
  <!-- The Open Graph protocol -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Road to HackMex: Dia 4 - Catcabbage" />
  <meta property="og:site_name" content="Tchai&#x27;s Halls of Reflection" />
  <meta property="og:description" content="Cuarta máquina del entrenamiento para Hackmex" />
  <meta property="og:url" content="https:&#x2F;&#x2F;IsaacNietoG.github.io&#x2F;blog&#x2F;250624hackmex2025&#x2F;" />
  
  <!---->
  
  <!---->
  

  <!-- CSS & JS -->
  <link rel="preload stylesheet" as="style" href="https://IsaacNietoG.github.io/main.css" />
  <style>
    :root {
      --bg: #f4f4f5;
      --bg-dark: #18181b;
      --header: #e4e4e7;
      --header-dark: #27272a;
    }
  </style>

  

  <!-- Dark Icon -->
  <link rel="preload" as="image" href="https://IsaacNietoG.github.io/icons/theme.svg" />

  <!-- Math -->
  
  <!---->

  <!-- Mermaid -->
  
  <!---->

  <!-- Favicon -->
  <link rel="icon" href="https://IsaacNietoG.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://IsaacNietoG.github.io/apple-touch-icon.png" />

  <!-- Feeds -->
  

  <!-- Canonical -->
  <link rel="canonical" href="https:&#x2F;&#x2F;IsaacNietoG.github.io&#x2F;blog&#x2F;250624hackmex2025&#x2F;" />

  <!-- Head inject -->
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header
  class="header fixed top-0 z-40 mx-auto min-h-[3.5rem] w-full"
>
  <div class="mx-auto w-full max-w-4xl p-3 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center">
        <a class="text-2xl font-semibold" href="https://IsaacNietoG.github.io">Tchai&#x27;s Halls of Reflection</a>
        <div
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] [background:url(./icons/theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]"
          role="button"
          aria-label="Dark"
        ></div>
      </div>
      
      <div
        class="btn-menu relative z-50 flex h-8 w-8 shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
        role="button"
        aria-label="Menu"
      ></div>
      
    </div>
    <script>
      // base
      const htmlClass = document.documentElement.classList;
      setTimeout(() => {
        htmlClass.remove("not-ready");
      }, 10);

      // mobile menu
      const btnMenu = document.querySelector(".btn-menu");
      btnMenu?.addEventListener("click", () => {
        htmlClass.toggle("open");
      });

      // dark theme
      const setDark = (isDark) => {
        if (isDark) {
          document.body.dispatchEvent(new CustomEvent("set-theme", { detail: "dark" }));
          htmlClass.add("dark");
        } else {
          document.body.dispatchEvent(new CustomEvent("set-theme", { detail: "light" }));
          htmlClass.remove("dark");
        }
        localStorage.setItem("dark", isDark);
      };

      // init
      const darkScheme = window.matchMedia("(prefers-color-scheme: dark)");
      if (htmlClass.contains("dark")) {
        setDark(true);
      } else {
        const darkVal = localStorage.getItem("dark");
        setDark(darkVal ? darkVal === "true" : darkScheme.matches);
      }

      // listen system
      darkScheme.addEventListener("change", (event) => {
        setDark(event.matches);
      });

      // manual switch
      const btnDark = document.querySelector(".btn-dark");
      btnDark.addEventListener("click", () => {
        setDark(localStorage.getItem("dark") !== "true");
      });
    </script>
    
    <nav class="flex w-full items-center lg:w-auto">
      <ul
        class="nav-wrapper flex w-full flex-col py-2 lg:w-auto lg:flex-row lg:self-center lg:py-0"
      >
        
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://IsaacNietoG.github.io/portfolio"
            >Portfolio</a
          >
        </li>
        
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://IsaacNietoG.github.io/blog"
            >Blog</a
          >
        </li>
        
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://IsaacNietoG.github.io/about"
            >About</a
          >
        </li>
        
      </ul>
      <!-- Header Nav inject -->
      
    </nav>
    
  </div>
</header>


    <!-- Body Start inject -->
    

    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl break-words px-4 pb-16 pt-32 dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg"
    >
      
<article>
  <!-- Page Start inject -->
  

  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Road to HackMex: Dia 4 - Catcabbage</h1>
    <div class="text-sm antialiased opacity-60">
  
  <time>2025-06-24</time>
  <span class="mx-1">&middot;</span>
  <span>5min</span>
  <!---->
  <!---->
  <!---->
  <!---->
  
  <span class="mx-1">&middot;</span>
  <span>IsaacNietoG</span>
  
  <!-- Page Info inject -->
  
</div>

  </header>

  

  <!-- TOC -->
  <!---->
<div class="block-bg mb-12 flex rounded-lg p-2 text-lg">
  <details>
    <summary class="cursor-pointer py-1 pl-4">
      <span>Table of Contents</span>
    </summary>
    <div class="px-2">
      <ul>
        
        <li>
          <a class="no-underline hover:underline" href="https://IsaacNietoG.github.io/blog/250624hackmex2025/#writeup-catcabbage-echoctf"
            >Writeup: catcabbage - echoCTF</a
          >
          
          <ul>
            
            <li>
              <a class="no-underline hover:underline" href="https://IsaacNietoG.github.io/blog/250624hackmex2025/#informacion-general"
                >Información General</a
              >
            </li>
            
            <li>
              <a class="no-underline hover:underline" href="https://IsaacNietoG.github.io/blog/250624hackmex2025/#descripcion-de-la-maquina"
                >Descripción de la máquina</a
              >
            </li>
            
            <li>
              <a class="no-underline hover:underline" href="https://IsaacNietoG.github.io/blog/250624hackmex2025/#enumeracion"
                >Enumeración</a
              >
            </li>
            
            <li>
              <a class="no-underline hover:underline" href="https://IsaacNietoG.github.io/blog/250624hackmex2025/#explotacion"
                >Explotación</a
              >
            </li>
            
            <li>
              <a class="no-underline hover:underline" href="https://IsaacNietoG.github.io/blog/250624hackmex2025/#escalacion-de-privilegios"
                >Escalación de Privilegios</a
              >
            </li>
            
          </ul>
          
        </li>
        
      </ul>
    </div>
  </details>
</div>

<!---->

  <!-- Content -->
  <section><h1 id="writeup-catcabbage-echoctf">Writeup: catcabbage - echoCTF</h1>
<h2 id="informacion-general">Información General</h2>
<p><img src="/images/blog/Screenshot_20250623_104359.png" alt="" /></p>
<h2 id="descripcion-de-la-maquina">Descripción de la máquina</h2>
<p>Come see our unique cat that likes to eat cabbage!!! Come on in, have a bite.</p>
<h2 id="enumeracion">Enumeración</h2>
<h3 id="escaneo-inicial">Escaneo Inicial</h3>
<p>Comenzamos escaneando con Nmap mientras concurrentemente nos metemos a la ip en el navegador para descubrir rápidamente un posible servicio HTTP.
Y efectivamente, encontramos un servicio HTTP el cual está hosteando un CMS llamado BlackCat.
De paso, cuando termina nmap, nos confirma dicho servicio, varias carpetas interesantes prohibidas por robots.txt y un servicio SSH en puerto 22.</p>
<p><img src="/images/blog/Screenshot_20250623_100954.png" alt="" /></p>
<h3 id="analisis-de-servicios">Análisis de Servicios</h3>
<p>Encontramos un BlackCat CMS en el servicio http el cual carga mal y dice que está en mantenimiento.</p>
<p><img src="/images/blog/Screenshot_20250623_100740.png" alt="" /></p>
<p>Si clickeamos a cualquier enlace interactivo de ahí nos redirigirá a un dominio específico, quiero pensar que la mala carga es por hojas de estilo ligadas al dominio. Entonces ligamos la ip a dicho dominio en nuestro /etc/hosts y con esto carga correctamente</p>
<p><img src="/images/blog/Screenshot_20250623_100843.png" alt="" />
<img src="/images/blog/Screenshot_20250623_100905.png" alt="" /></p>
<p>Una vez teniendo buena visibilidad del sitio, podemos comenzar a explorar el servicio para ver qué podemos encontrar, comencemos por explorar los sitios prohibidos por robots.txt que nos dió nmap y que también nosotros podríamos explorar en /robots.txt
Varios son redirecciones que nos llevan directamente de regreso a la página de mantenimiento y unas cuantas son sitios directamente prohibidos, excepto por uno.
Encontramos panel de admin en /backend y comenzamos a probar contraseñas
<img src="/images/blog/Screenshot_20250623_101641.png" alt="" />
Empecé con las credenciales tradicionales y que por fuerza de hábito siempre probaremos a mano para ahorrarnos configurar herramientas:</p>
<ul>
<li>admin:admin</li>
<li>admin:password</li>
<li><strong>admin:admin123</strong></li>
</ul>
<p>Y la ultima fue la que amarró. Entonces ya tenemos credenciales de admin.</p>
<h2 id="explotacion">Explotación</h2>
<h3 id="busqueda-de-vulnerabilidades">Busqueda de vulnerabilidades</h3>
<p>Vamos a buscar vulnerabilidades que nos puedan ayudar, y comencemos por el servicio hosteado, porque es poco común que el foothold se encuentre en los otros dos servicios (el servidor HTTP en sí y la versión de SSH)</p>
<p>Y el primer resultado al buscar exploits para este CMS es el siguiente:</p>
<p><a href="https://www.exploit-db.com/exploits/51605">Blackcat Cms v1.4 - Remote Code Execution (RCE) - PHP webapps Exploit</a></p>
<p>Vamos a probar si el servicio es vulnerable a este exploit, y a festejar porque su primer requisito es justamente tener credenciales de admin</p>
<p><img src="/images/blog/Screenshot_20250623_101058.png" alt="" /></p>
<h3 id="intentos-de-explotaciones">Intentos de explotaciones</h3>
<p>Preparamos el payload según lo marcan las instrucciones del exploit y lo subimos bajo estas mismas instrucciones. Si lo intentamos consultar en la estructura dada por el exploit nos encontraremos con un error 404, pero lo que debemos hacer es simplemente ajustar la estructura del enlace a la estructura de la máquina. Para esto vamos a considerar las siguientes cosas:</p>
<ul>
<li>En el exploit veremos que el backend vive en /BlackCatCMS-1.4/upload/backend/......</li>
<li>En la máquina, el backend vive directamente en /backend</li>
<li>Entonces, en el exploit /BlackCatCMS-1.4/upload/ es equivalente a la raíz / en la máquina</li>
</ul>
<p>Dado esto, el enlace correcto para buscar nuestra payload es:</p>
<p>/modules/lib_jquery/plugins/poc/poc.php?code=cat%20/etc/passwd</p>
<h3 id="explotacion-1">Explotación</h3>
<p>Si entramos al payload nos daremos cuenta de que fué exitoso y podremos ejecutar comandos, lo cual ya nos da nuestro primer foothold.</p>
<p><img src="/images/blog/Screenshot_20250623_102401.png" alt="" /></p>
<p>Usando este foothold levantamos nuestro netcat, upgradeamos la terminal y we are in</p>
<p><img src="/images/blog/Screenshot_20250623_102547.png" alt="" /></p>
<p>Ya desde el payload podíamos sacar la bandera en /etc/passwd, pero si no la tenemos todavía, ahora con la shell la podemos sacar. Una vez dentro, también por fuerza de hábito probaremos si ya podemos también encontrar la bandera en printenv</p>
<p><img src="/images/blog/Screenshot_20250623_102638.png" alt="" /></p>
<h2 id="escalacion-de-privilegios">Escalación de Privilegios</h2>
<h3 id="analisis">Análisis</h3>
<p>Una vez dentro, comenzamos a analizar nuestras capacidades para ver de dónde nos vamos a agarrar para escalar privilegios. Antes de correr linpeas voy a correr un sudo -l porque ultimamente me ha pagado bastante bien ese comando. Y justo vemos que tenemos permiso de correr como sudo un binario llamado cabbage. -curiosamente la máquina se llama catcabbage-.</p>
<p><img src="/images/blog/Screenshot_20250623_102804.png" alt="" /></p>
<p>Y analizando su código fuente vemos que es lo siguiente:</p>
<p><img src="/images/blog/Screenshot_20250623_102952.png" alt="" /></p>
<p>El binario entonces lo que hace es tomar una serie de archivos y los pasa por broccoli-compass, que es una librería que traduce SASS en CSS.</p>
<p>Si googleamos la biblioteca, nos encontraremos con la siguiente vulnerabilidad:</p>
<p><a href="https://github.com/omnitaint/Vulnerability-Reports/blob/9d65add2bca71ed6d6b2e281ee6790a12504ff8e/reports/broccoli-compass/report.md">Vulnerability in broccoli-compass</a></p>
<p><img src="/images/blog/Screenshot_20250623_103504.png" alt="" /></p>
<p>La vulnerabilidad permite ejecución de comandos sirviéndose de contaminar el nombre de un archivo que pueda ser recibido por la biblioteca en la lista de archivos a traducir. Si analizamos la PoC adjunta, podemos entender claramente su funcionalidad y darnos cuenta de que es replicable en nuestro caso.</p>
<p><img src="/images/blog/Screenshot_20250623_103723.png" alt="" /></p>
<p>Vemos que efectivamente es replicable a nivel de nuestro usuario actual, si lo corremos como root con sudo es altamente probable de que sea el mismo caso.</p>
<h3 id="explotacion-2">Explotación</h3>
<p>De aquí podríamos proceder de varias formas una vez teniendo ejecución de comandos como sudo, podríamos:</p>
<ul>
<li>Correr un netcat para abrirnos una sesión de root en otro puerto</li>
<li>Modificar /etc/passwd para modificar la contraseña de root y acceder probablemente por ssh</li>
<li>Ponerle SUID a /bin/bash para poder abrirnos in-spot un bash con id de root.</li>
<li>Dumpear las banderas en textos legibles por nosotros</li>
</ul>
<p>Y yo voy a aplicar la última jajaj. Vamos a dumpear las banderas que nos faltan, que es:</p>
<ul>
<li>El archivo en /root</li>
<li>La bandera en /etc/passwd</li>
</ul>
<p>Con los siguientes comandos:</p>
<pre><code>sudo cabbage &#x27;$(cat &#x2F;etc&#x2F;shadow &gt; &#x2F;tmp&#x2F;hola)&#x27;
sudo cabbage &#x27;$(ls -la &#x2F;root &gt; &#x2F;tmp&#x2F;holaa)&#x27;
</code></pre>
<p><img src="/images/blog/Screenshot_20250623_103758.png" alt="" /></p>
<p>Si leemos estos archivos, tendremos las banderas</p>
<p><strong>headshot</strong></p>
</section>

  <hr />

  <!-- Post Taxonomies -->
  
<!---->

  <!-- Post Nav -->
  
<!---->

  <!-- Comment -->
  

  <!-- Page End inject -->
  
</article>

    </main>

    <footer class="mx-auto flex max-w-3xl flex-wrap items-center px-8 py-4 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
    <!---->
    <!---->
    &copy; 2025<!---->
    
    <a class="link" href="https://IsaacNietoG.github.io">
      IsaacNietoG
    </a>
    
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <a class="link mr-6 lg:ml-6" href="https://www.getzola.org/" rel="noopener" target="_blank">
      Powered by Zola
    </a>
    <a class="link" href="https://github.com/st1020/kita" rel="noopener" target="_blank">✎ Kita</a>
  </div>
  <!-- Footer inject -->
  
</footer>


    <!-- Body End inject -->
    
  </body>
</html>
